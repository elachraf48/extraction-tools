<!DOCTYPE html>
<html>
<head>
  <title>Text File Merger and Splitter</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    

#loadingGif{
  position: fixed;
  left: 46%;
  top: 20%;
  z-index: 9999;
}
.box{
  border: solid black 2px;
  border-radius: 25px;
  height: 100%;
  padding: 1%;
  text-align: center;
}
#resultTextContainer {
  position: fixed;
  z-index: 800;
  top: 20%;
  left: 50%;
  transform: translateX(-50%);
  transition: opacity 3s;
  width: 400px;
}

#resultTextContainer.show {
  opacity: 1;
}

#resultTextContainer.hide {
  opacity: 0;
}
  </style>
</head>

<body>
  <div class="container">
    <div class="mb-3" id="loadingGif" style="display: none;">
      <img src="loading.gif" alt="Loading...">
    </div>
    <div class="row">
      <div class="col">
        <div id="megretandsplit" class="container box mt-5">
            <h3>Text File Merger and Splitter</h3>
            <input  style="display: none;" name="file" id="fileInput" type="file" multiple>
          
            <div class="check">
              <button class="btn btn-primary m-2 px-4" onclick="document.getElementById('fileInput').click()">megret text</button>
              <br>
              <input style="size: 200px;" type="checkbox" name="sep" id="sep" checked>

              <label for="sep">split by __SEP__ </label>

            </div>
           
        </div>
      </div>
      <div class="col">
        <div id="megretandsplit50" class="container box mt-5">
          <h3>Text File Splitter</h3>
          <input style="display: none;" name="file" id="fileInput50" type="file">
          <div class="check">
            <button class="btn btn-primary m-2 px-4" onclick="document.getElementById('fileInput50').click()">Split text</button>
            <br>
            <label for="sep">Split By Line </label><br>
            <input type="number" name="" id="number" value="50" required>
          </div>
        </div>
      </div>
  </div>
</div>
<div class="mb-3" id="resultTextContainer" style="display: none;">
  <div class="alert alert-success fixed-top mt-3" role="alert" id="outputAlert">
      Result:
  </div>
</div>
  <script>
    let fileContents = [];
    let mergedContent = '';

    function handleFiles(e) {
        fileContents = [];
        const files = Array.from(e.target.files);
        if (files.length > 0) {
            document.getElementById('loadingGif').style.display = 'block';
            document.getElementById('resultTextContainer').style.display = 'block';
            const fileCount = files.length;
            document.getElementById('outputAlert').innerText = `Files merged and downloaded successfully! ${fileCount}`;
            readFiles(0, files); // Start reading the files
        } else {
            document.getElementById('resultTextContainer').style.display = 'none';
            document.getElementById('outputAlert').innerText = 'No files selected.';
        }
    }

    document.getElementById('fileInput').addEventListener('change', handleFiles);

    function readFiles(index, files) { // Pass the index and files as parameters
        const check = document.getElementById('sep').checked;

        if (index >= files.length) {
            if(check){
               mergedContent = fileContents.join("\n__SEP__\n");
               mergeAndDownloadFiles();
            }
            else{
              mergedContent = fileContents.join("\n");
              mergeAndDownloadFiles();
            }
          
        } else {
            const fileReader = new FileReader();
            fileReader.onload = function (e) {
                const content = e.target.result;
                fileContents.push(content);
                readFiles(index + 1, files); // Call the function recursively with updated index
            };
            fileReader.onerror = function (e) {
                alert('Error reading file: ', e);
                readFiles(index + 1, files); // Call the function recursively with updated index
            };
            fileReader.readAsText(files[index]);
        }
    }

    function mergeAndDownloadFiles() {
          const check = document.getElementById('sep').checked;

          let mergedContent= '';
          if(check){
            // Merge the file contents with separator "__SEP__"
            mergedContent = fileContents.join("\n__SEP__\n");
          }
          else{
            // Just join all lines of each file without any separators between them
            mergedContent = fileContents.join("\n");
            }
        
       // Download the merged content as a text file
          const downloadLink = document.createElement('a');
          downloadLink.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(mergedContent);
          downloadLink.download = 'after_split.txt';
          document.body.appendChild(downloadLink);
          downloadLink.click();
          document.body.removeChild(downloadLink);

          // Hide loading GIF and show success message with animation
          // Hide loading GIF and show success message
          document.getElementById('loadingGif').style.display = 'none';
          mergedContent = ''; // Reset the merged content

          const resultTextContainer = document.getElementById('resultTextContainer');

          resultTextContainer.classList.add('show');
          resultTextContainer.classList.remove('hide');

          // Hide the result text after 3 seconds
          setTimeout(() => {
              resultTextContainer.classList.add('hide');
          }, 3000);
    }
    //split of number line

    function handleFiles50(e) {
      const file = e.target.files[0];
      if (file) {
        splitFile(file);
      } else {
        console.log("No file selected.");
      }
    }
  
    function splitFile(file) {
      const number = parseInt(document.getElementById("number").value);
      if (!isNaN(number) && number > 0) {
        const reader = new FileReader();
        reader.onload = function () {
          const content = reader.result;
          const lines = content.split("\n");
          const splitContent = [];

          document.getElementById('loadingGif').style.display = 'block';
          document.getElementById('outputAlert').innerText = `Files Split and downloaded successfully! `;
          for (let i = 0; i < lines.length; i += number) {
            splitContent.push(lines.slice(i, i + number).join("\n"));
          }
          createZip(splitContent);
        };
        reader.readAsText(file);
      } else {
        console.log("Invalid number of lines.");
      }
    }
  
    function createZip(splitContent) {
      const zip = new JSZip();
      for (let i = 0; i < splitContent.length; i++) {
        zip.file(`part_${i + 1}.txt`, splitContent[i]);
      }
      zip.generateAsync({ type: "blob" }).then(function (content) {
        downloadZip(content);
      });
    }
  
    function downloadZip(zipBlob) {
      const downloadLink = document.createElement("a");
      downloadLink.href = URL.createObjectURL(zipBlob);
      downloadLink.download = "split_files.zip";
      document.body.appendChild(downloadLink);
      downloadLink.click();
      document.body.removeChild(downloadLink);
      // Hide loading GIF and show success message
      document.getElementById('loadingGif').style.display = 'none';
      document.getElementById('resultTextContainer').style.display = 'block';

      const resultTextContainer = document.getElementById('resultTextContainer');

      resultTextContainer.classList.add('show');
      resultTextContainer.classList.remove('hide');

      // Hide the result text after 3 seconds
      setTimeout(() => {
        resultTextContainer.classList.add('hide');
    }, 3000);
    }
  
    document.getElementById("fileInput50").addEventListener("change", handleFiles50);
  
  
</script>
<!-- Add the JSZip library to your HTML -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js"></script>

</body>


</html>
