<!DOCTYPE html>
<html>
<head>
  <title>Text File Merger and Splitter</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    

a{
  text-decoration: none;
  color: white;
}

.form{
position: relative;
width: 100%;
height: 200px;
border: 3px dashed grey;
border-radius: 10px;

}
.form div{
width: 100%;
height: 100%;
text-align: center;
line-height: 170px;
color: black;
font-family: Arial;
position: absolute;
top: 10%;
z-index: -1;
}
.form input{
position: relative;
margin: 0;
padding: 0;
width: 100%;
height: 100%;
outline: none;
opacity: 0;
}
button {
  border-radius: 10px;
  padding: 10px 20px;
  background: #1950A3;
  outline: none;
  border: none;
  color: white;
  font-size: 16px;
  cursor: pointer;
}

.btn1 {
  border-radius: 10px;
  padding: 10px 20px;
  background: #8b6106;
  outline: none;
  border: none;
  color: white;
  font-size: 16px;
  cursor: pointer;
}



div img {
  position: relative;
  top: 30px;
  left: -10px;
}

#fileName {
  position: relative;
  top: 10px;
}
#loadingGif{
  position: fixed;
  left: 50%;
}
  </style>
</head>

<body>
  <div class="container mt-5">
      <h1>Text File Merger and Splitter</h1>
      <form>
          <div class="form">
              <input name="file" id="fileInput" type="file" multiple>
              <div>
                  <img src="upload.png" alt="upload" width="7%" class="mx-2">
                  Upload your files here or
                  <button class="btn bg-color-dblue btn-primary px-4 py-3" onclick="document.getElementById('fileInput').click()">Browse</button>
              </div>
              <span id="fileName" class="text-primary"></span>
          </div>
      </form>
      <div class="mb-3" id="loadingGif" style="display: none;">
          <img src="loading.gif" alt="Loading...">
      </div>
      <div class="mb-3" id="resultTextContainer" style="display: none;">
        <div class="alert alert-success" role="alert" id="outputAlert">
            Result:
        </div>
    </div>
  </div>

  <script>
    let fileContents = [];
    let mergedContent = '';

    function handleFiles(e) {
        fileContents = [];
        const files = Array.from(e.target.files);
        if (files.length > 0) {
            document.getElementById('resultTextContainer').style.display = 'block';
            const fileCount = files.length;
            document.getElementById('outputAlert').innerText = `Selected ${fileCount}`;
            readFiles(0, files); // Start reading the files
        } else {
            document.getElementById('resultTextContainer').style.display = 'none';
            document.getElementById('outputAlert').innerText = 'No files selected.';
        }
    }

    document.getElementById('fileInput').addEventListener('change', handleFiles);

    function readFiles(index, files) { // Pass the index and files as parameters
        if (index >= files.length) {
            mergedContent = fileContents.join("\n__SEP__\n");
            mergeAndDownloadFiles();
        } else {
            const fileReader = new FileReader();
            fileReader.onload = function (e) {
                const content = e.target.result;
                fileContents.push(content);
                readFiles(index + 1, files); // Call the function recursively with updated index
            };
            fileReader.onerror = function (e) {
                console.error('Error reading file: ', e);
                readFiles(index + 1, files); // Call the function recursively with updated index
            };
            fileReader.readAsText(files[index]);
        }
    }

    function mergeAndDownloadFiles() {
        // Merge the file contents with separator "__SEP__"
        const mergedContent = fileContents.join("\n__SEP__\n");

        // Download the merged content as a text file
        const downloadLink = document.createElement('a');
        downloadLink.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(mergedContent);
        downloadLink.download = 'after_split.txt';
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);

        // Hide loading GIF and show success message
        document.getElementById('loadingGif').style.display = 'none';
        document.getElementById('outputAlert').innerText = 'Files merged and downloaded successfully!';
        mergedContent = ''; // Reset the merged content
    }
</script>
</body>


</html>
